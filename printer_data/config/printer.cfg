# This file contains common pin mappings for the BIGTREETECH SKR E3
# Turbo. To use this config, the firmware should be compiled for the
# LPC1769.
# Extra low level: enabled.
# Processor model: lpc1769 (120mhz).
# Smoothieware bootloader: enabled-OR-
# Bootloader Offset 16kib.
# GPIO pins: blank. Comms Interface
# for 
# USB: USB. OR. (For UART): UART0 P03/P02. Baudrate: 250000.
#
# cd ~/klipper/
# make menuconfig
# make clean
# make
#
# directory: /home/pi/klipper/out/klipper.bin
#

# See docs/Config_Reference.md for a description of parameters.

# Compile/upgrade Raspberry Pi MCU Firmware
# cd ~/klipper/
# sudo cp ./scripts/klipper-mcu.service /etc/systemd/system/
# sudo systemctl enable klipper-mcu.service
# make menuconfig
#
# Choose micro-controller Architecture (Linux process)
# Quit and save
#
# make clean
# sudo service klipper stop
# make -j4 flash
# sudo service klipper start

# cd ~/klipper
# make menuconfig
# make clean
# make -j4
# sudo service klipper stop
# mv out/klipper.bin out/FIRMWARE.bin <---- dont use
# ~/klipper/scripts/flash-sdcard.sh /dev/serial/by-id/usb-Klipper_lpc1769_1520010CC09869AF0AC1405EC52000F5-if00 btt-skr-e3-turbo
# sudo service klipper start

# Useful Information:
# Pin names may be preceded by ! to indicate that a reverse polarity should be used (eg, trigger on low instead of high).
# Input pins may be preceded by ^ to indicate that a hardware pull-up resistor should be enabled for the pin.
#
# Comment multiple line "command + /"
#
# A/B belts tension value of 1.9 to 2.3
# position for test testing
# X117, Y114



# Demon_Klipper_Essentials_Unified Notes
# https://github.com/3DPrintDemon/Demon_Klipper_Essentials_Unified/tree/main

# Updating
# Original commands:
# python3 -m pip install rich
# python3 -m pip install ConfigUpdater

# Workarounds:
# ~/klippy-env/bin/pip install rich
# ~/klippy-env/bin/python3 -m pip install ConfigUpdater
# ~/klippy-env/bin/python3 ~/printer_data/config/Demon_Klipper_Essentials_Unified/Other_Files/Demon_Install_Script/Demon_config_update.py

# Not needed:
# /home/pi/klippy-env/bin/python3 -m pip install --upgrade pip


[include ./Demon_Klipper_Essentials_Unified/*.cfg]
[include ./Demon_User_Files/*.cfg]
[include ./KAMP_LiTE/*.cfg]
[include ./Heat_Soak_Toolhead_LEDs.cfg]
[include ./My_Macros.cfg]
[include ./Neopixel_Control.cfg]
[include ./Demon_Klipper_Essentials_Unified/Other_Files/Demon_User_Files_Updater/Demon_User_Files_Handler_v*.cfg]

###################################################################################
# MCUs
###################################################################################

################################
# BTT SKR Mini E3 Turbo Mainboard
################################
[mcu]
#serial:
#baud: 250000
#canbus_uuid:
#canbus_interface:
#restart_method:
#is_non_critical: False
serial: /dev/serial/by-id/usb-Klipper_lpc1769_1520010CC09869AF0AC1405EC52000F5-if00

################################
# Raspberry Pi 4 Additional MCU
################################
# Compile/upgrade Raspberry Pi MCU Firmware
# cd ~/klipper/
# sudo cp ./scripts/klipper-mcu.service /etc/systemd/system/
# sudo systemctl enable klipper-mcu.service
# sudo systemctl start klipper-mcu.service
# make menuconfig
#
# Choose micro-controller Architecture (Linux process)
# Quit and save
#
# make clean
# sudo service klipper stop
# make flash
# sudo service klipper start
[mcu rpi]
serial: /tmp/klipper_host_mcu
[include configFiles/raspberryPi.cfg]

###################################################################################
# Danger Klipper Options
###################################################################################
#[danger_options]
#error_on_unused_config_options: True
#allow_plugin_override: False
#multi_mcu_trsync_timeout: 0.025
#homing_elapsed_distance_tolerance: 0.5
#temp_ignore_limits: False
#autosave_includes: False
#bgflush_extra_time: 0.250
#homing_start_delay: 0.001
#endstop_sample_time: 0.000015
#endstop_sample_count: 4
# Logging options:
#minimal_logging: False
#log_statistics: True
#log_config_file_at_startup: True
#log_bed_mesh_at_startup: True
#log_shutdown_info: True
#log_serial_reader_warnings: True
#log_startup_info: True
#log_webhook_method_register_messages: False

###################################################################################
# Main Printer Attributes
###################################################################################

[printer]
square_corner_velocity: 5.0
kinematics: limited_corexy
#max_velocity: 707        # Hypotenuse of 500 and 500
max_velocity: 190
max_z_velocity: 8
# max_x_velocity: 500 # not used just here to help explain config
# max_y_velocity: 500 # not used just here to help explain config
max_accel: 6800         # Hypotenuse of your X/Y
max_x_accel: 4808
max_y_accel: 4808
max_z_accel: 100
scale_xy_accel: True # [True/False, default False]

###################################################################################
# Motors
###################################################################################

#step_pin:
#dir_pin:
#enable_pin:
#rotation_distance:
#microsteps:
#full_steps_per_rotation: 200
#gear_ratio:
#step_pulse_duration:
#endstop_pin:
#position_min: 0
#position_endstop:
#position_max:
#homing_speed: 5.0
#homing_retract_dist: 5.0
#homing_retract_speed:
#min_home_dist:
#second_homing_speed:
#homing_positive_dir:
#use_sensorless_homing:

#################################################
# E3D Super Whopper Motor ()
# Rated Current: DC 2Amp
# Rated Current 2A (RMS) or 2.8A (peak) per coil
################################################

# Motor A (Left Motor from the front)
[stepper_x]
step_pin: P1.4
dir_pin: !P1.8
enable_pin: !P1.0
microsteps: 32 # TMC2209 acheivable microsteps=8/16/32/64 (without interpolation), 32/64 should introduce noise reduction without positional artifacts
full_steps_per_rotation: 200 # 1.8 degree stepper motor value
# rotation_distance = <full_steps_per_rotation> * <microsteps> / <steps_per_mm>
# Or
# rotation_distance = <belt_pitch> * <number_of_teeth_on_pulley>
# This printer 2mm belt/pulley with 20 teeth
# rotation_distance = 40
rotation_distance: 40
endstop_pin: ^P1.29
position_endstop: 237 # Max Bed 234mm
position_min:   -5
position_max: 237 # full travel distance
# bed X cordinates are:0, 234
#homing_speed: 100 #Max
homing_speed: 40 #Max
homing_retract_dist: 5.0

#################################################
# E3D Super Whopper Motor
# Rated Current: DC 2Amp
# Rated Current 2A (RMS) or 2.8A (peak) per coil
#################################################

# Motor B (Right Motor from the front)
[stepper_y]
step_pin: P1.14
dir_pin: !P1.15
enable_pin: !P1.9
microsteps: 32 # TMC2209 acheivable microsteps=8/16/32/64 (without interpolation), 32/64 should introduce noise reduction without positional artifacts
full_steps_per_rotation: 200 # 1.8 degree stepper motor value
# rotation_distance = <full_steps_per_rotation> * <microsteps> / <steps_per_mm>
# Or
# rotation_distance = <belt_pitch> * <number_of_teeth_on_pulley>
# This printer 2mm belt/pulley with 20 teeth
# rotation_distance = 40
rotation_distance: 40
endstop_pin: ^P1.28
position_endstop: 234
position_min: 0
position_max: 234 # full travel distance
# bed Y cordinates are: 0, 234
#homing_speed: 100 #Max
homing_speed: 40 #Max
homing_retract_dist: 5.0

#################################################
# Creality 42-34 Motor
# Current Rating: 1.5A
# Rated Current 2A (RMS) or 2.8A (peak) per coil
#################################################
[stepper_z]
step_pin: P4.29
dir_pin: !P4.28
enable_pin: !P1.16
microsteps: 16 # TMC2209 acheivable microsteps=8/16/32/64 (without interpolation), 32/64 should introduce noise reduction without positional artifacts
full_steps_per_rotation: 200 # 1.8 degree stepper motor value
# rotation_distance = <screw_pitch> * <number_of_separate_threads>
# This printer T8 leadscrew (2mm pitch*1 starts)
# rotation_distance = 2
# The smallest step distance possible with that setup is 0.0003125 mm (or 0.3125 microns). (32 microsteps)
# The smallest step distance possible with that setup is 0.0003125 mm (or 0.3125 microns). (16 microsteps)
# Here is the breakdown of the calculation:

# 1. Full Steps per Rotation: A 1.8∘ motor has 200 full steps per revolution (360∘/1.8∘=200).
# 2. Total Microsteps: With 32 microsteps per full step, the motor requires 6,400 steps to complete one full revolution (200×32).
# 3. Lead Screw Travel: A single-start screw with a 2mm pitch moves the nut 2 mm per full revolution.
# 4. Resolution:
# 
# 2 mm/6,400 steps=0.0003125 mm/step
#

rotation_distance: 2
#endstop_pin:
endstop_pin: probe:z_virtual_endstop # For bltouch
#position_endstop: 0
position_min: -5 # For bltouch
position_max: 322
homing_speed: 25 #Max 100
# homing_retract_dist: 5.0

#################################################
# Creality 42-34 Motor
# Current Rating: 1A
# Rated Current 2A (RMS) or 2.8A (peak) per coil
#################################################
[stepper_z1]
step_pin: P2.11
dir_pin: !P2.12
enable_pin: !P0.21
microsteps: 16 # TMC2209 acheivable microsteps=8/16/32/64 (without interpolation), 32/64 should introduce noise reduction without positional artifacts
full_steps_per_rotation: 200 # 1.8 degree stepper motor value
# rotation_distance = <screw_pitch> * <number_of_separate_threads>
# This printer T8 leadscrew (2mm pitch*1 starts)
# rotation_distance = 2
rotation_distance: 2

######################################################################################
# https://trianglelab.net/u_file/2112/11/file/Orbiterv20FirmwareConfiguration-031c.pdf
# LDO-36STH20-1004AHG Motor
# Current Rating: 1Amp
# Rated Current 2A (RMS) or 2.8A (peak) per coil
######################################################################################
[extruder]
step_pin: P2.6
dir_pin: !P2.7
enable_pin: !P0.4
microsteps: 32 # TMC2209 acheivable microsteps=8/16/32/64 (without interpolation).
full_steps_per_rotation: 200 # 1.8 degree stepper motor value
## keep rotation distance rounded to three decimal places
#rotation_distance: 35.65 #calibrated value
#rotation_distance: 35.185 #value before merc plus test
#rotation_distance: 35.086 #testing merc plus value
rotation_distance: 34.7775 # LDO Value 4.637 without gear ratio of 7.5:1 (4.637x7.5+34.7775)
#rotation_distance: 35.0863122 #copied from 5+ current values to match flow values
gear_ratio: 7.5:1
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: P2.3
#max_power: 1.0
#   The maximum power (expressed as a value from 0.0 to 1.0) that the
#   heater_pin may be set to. The value 1.0 allows the pin to be set
#   fully enabled for extended periods, while a value of 0.5 would
#   allow the pin to be enabled for no more than half the time. This
#   setting may be used to limit the total power output (over extended
#   periods) to the heater. The default is 1.0.
sensor_type: PT1000
sensor_pin: P0.23
# PID_CALIBRATE HEATER=extruder TARGET=240 TOLERANCE=0.02 WRITE_FILE=1
#pullup_resistor: 4700
#   The resistance (in ohms) of the pullup attached to the thermistor.
#   This parameter is only valid when the sensor is a thermistor. The
#   default is 4700 ohms.
#pid_version: 1
#pid_target: 240.00
#pid_tolerance: 0.0200
#control: pid
#pid_kp: 14.589
#pid_ki: 1.077
#pid_kd: 49.421
max_delta: 2.0
#   On 'watermark' controlled heaters this is the number of degrees in
#   Celsius above the target temperature before disabling the heater
#   as well as the number of degrees below the target before
#   re-enabling the heater. The default is 2 degrees Celsius.
min_temp: 10
max_temp: 350
max_extrude_only_distance: 500
#max_extrude_only_velocity: 15
min_extrude_temp: 180 # Change to "10" when configuring E-Steps
max_extrude_cross_section: 50.
##  Try to keep pressure_advance below 1.0
pressure_advance: 0.000
## LDO suggested value 0.03
pressure_advance_smooth_time: 0.03

###################################################################################
# Bed Heater
###################################################################################
[heater_bed]
heater_pin: P2.5
sensor_type: EPCOS 100K B57560G104F
sensor_pin: P0.25
# PID_CALIBRATE HEATER=heater_bed TARGET=100 TOLERANCE=0.02 WRITE_FILE=1
# Bed PID Tuned to 100c. Takes 7 minutes to full heat. Creality bed max: 130c
#pid_version: 1
#pid_target: 90.00
#pid_tolerance: 0.0200
#control: pid
#pid_Kp: 60.395
#pid_Ki: 1.169
#pid_Kd: 779.850
min_temp: 0
max_temp: 130

###################################################################################
# Bed Mesh
###################################################################################
[bed_mesh]
speed: 120
horizontal_move_z: 5
## Example from Voron:	Uncomment for 350mm build
#mesh_min: 40, 40
#mesh_max: 310,310
#zero_reference_position: 175,175 #for use with stock z endstop

# for min/max use probe co-ordinates, not nozzle position
mesh_min: 15, 15
mesh_max: 205, 205
probe_count: 7, 7
fade_start: 0.6
fade_end: 10
fade_target: 0
zero_reference_position: 117.5, 117.5
algorithm: bicubic
mesh_pps: 2, 2
bicubic_tension: 0.2 #default
#bicubic_tension: 0.5

###################################################################################
# Bed Tilt
###################################################################################

#[bed_tilt]
#x_adjust: 0
#y_adjust: 0
#z_adjust: 0
#points:
#speed: 50
#horizontal_move_z: 5

###################################################################################
# Bed Screw Manual Calibration
###################################################################################

#[bed_screws]
#screw1:
#screw1_name:
#screw1_fine_adjust:
#screw2:
#screw2_name:
#screw2_fine_adjust:
#horizontal_move_z: 5
#probe_height: 0
#speed: 50
#probe_speed: 5

###################################################################################
# Bed Screw Automated Calibration
###################################################################################

#[screws_tilt_adjust]
#screw1:
#screw1_name:
#screw2:
#screw2_name:
#speed: 50
#horizontal_move_z: 5
#screw_thread: CW-M3
[screws_tilt_adjust]
# Nozzle Locations
# x locations of the screws on the bed: 32, 201.5
# y locations of the screws on the bed: 28, 197.5
# Probe Locations
# x locations of the screws on the bed: 64, 233.5
# y locations of the screws on the bed: 34.5, 204

screw1: 64, 204
screw1_name: rear left screw
screw2: 233.5, 34.5
screw2_name: front right screw
screw3: 233.5, 204
screw3_name: rear right screw
screw4: 64, 34.5
screw4_name: front left screw
horizontal_move_z: 5
speed: 120
screw_thread: CW-M4

###################################################################################
# Z Tilt Calibration
###################################################################################

#[z_tilt]
#z_positions:
#points:
#speed: 50
#horizontal_move_z: 5
#min_horizontal_move_z: 1.0
#adaptive_horizontal_move_z: False
#retries: 0
#retry_tolerance: 0
#increasing_threshold: 0.0000001
[z_tilt]
z_positions: 117, 275
             117, -31
# points: 149, 222.5
#         149, 14.
points: 149, 218
        149, 19
speed: 120
horizontal_move_z: 5
retries: 20
#retry_tolerance: 0.0020
#min 0.0003125
#retry_tolerance:  0.0009375 # 32 microsteps, 3x lowest step distance 0.0003125 (32 microsteps)
retry_tolerance:  0.001875 # 32 microsteps, 3x lowest step distance 0.000625 (16 microsteps)
#retry_tolerance:  0.00250

###################################################################################
# Skew Calibration
###################################################################################
[skew_correction]

###################################################################################
# Z Thermal Adjustment
###################################################################################

#[z_thermal_adjust]
#temp_coeff:
#smooth_time:
#z_adjust_off_above:
#max_z_adjustment:
#sensor_type:
#sensor_pin:
#min_temp:
#max_temp:
#gcode_id:

###################################################################################
# Customized Homing Removed when using Demon Klipper Essentials Unified
###################################################################################

# [safe_z_home]
# #home_xy_position: 117,112 # nozzle at center
# #x_offset: -31.0
# #y_offset: -6.5
# #home_xy_position: 152, 120 # probe at center
# home_xy_position: 149, 118.5 # probe at center
# speed:120
# z_hop: 2
# z_hop_speed: 5

###################################################################################
# Homing Override
###################################################################################

#[homing_override]
#gcode:
#axes: xyz
#set_position_x:
#set_position_y:
#set_position_z:

###################################################################################
# Macros
###################################################################################

[auto_speed]
[include macros/gitHubBackUp.cfg]
# [include macros/zCalibration.cfg]
# [include macros/bedLeveling.cfg]
[include macros/inputShapingTools.cfg]
# [include macros/printerCalibration.cfg]
[include macros/speedCalibration.cfg]
[include timelapse.cfg]
# [include macros/axisTwistCalibration.cfg]
[include macros/zerogPurge.cfg]
# [include macros/nozzleBrush.cfg]
[include configFiles/chamberTemp.cfg]

###################################################################################
# Save Variables, persistant on restart
###################################################################################
#[save_variables]
#filename:
#   Required - provide a filename that would be used to save the
#   variables to disk e.g. ~/variables.cfg
# [save_variables]
# filename = ~/printer_data/config/demon_vars.cfg
[save_variables]
filename = ~/demon_vars.cfg

###################################################################################
# Idle Timeout
###################################################################################

# [idle_timeout]
# #gcode:
# #   A list of G-Code commands to execute on an idle timeout. See
# #   docs/Command_Templates.md for G-Code format. The default is to run
# #   "TURN_OFF_HEATERS" and "M84".
# #timeout: 1800 # 30 minutes
# #timeout: 2400 # 40 minutes
# timeout: 3600 # 60 minutes
[idle_timeout]
gcode:
    _DEMON_IDLE_TIMEOUT
timeout: 3600 # 60 minutes

###################################################################################
# Virtual SD Card (Handeled in Mainsail
###################################################################################

#[virtual_sdcard]
#path:
#   The path of the local directory on the host machine to look for
#   g-code files. This is a read-only directory (sdcard file writes
#   are not supported). One may point this to OctoPrint's upload
#   directory (generally ~/.octoprint/uploads/ ). This parameter must
#   be provided.
#on_error_gcode:
#   A list of G-Code commands to execute when an error is reported.
#   See docs/Command_Templates.md for G-Code format. The default is to
#   run TURN_OFF_HEATERS.
#with_subdirs: False
#   Enable scanning of subdirectories for the menu and for the
#   M20 and M23 commands. The default is False.

###################################################################################
# Turn on Force Move
###################################################################################

[force_move]
enable_force_move: True
#   Set to `True` to enable FORCE_MOVE and SET_KINEMATIC_POSITION
#   extended G-Code commands. The default is `True`.


###################################################################################
# Pause Remove (Handeled in Mainsail)
###################################################################################

#[pause_resume]
#recover_velocity: 50.
#   When capture/restore is enabled, the speed at which to return to
#   the captured position (in mm/s). Default is 50.0 mm/s.

###################################################################################
# Firmware Retraction
###################################################################################

[firmware_retraction]
#retract_length: 0.0
#retract_speed: 20.0
#unretract_extra_length: 0.0
#unretract_speed: 10.0
#z_hop_height: 0.0
retract_length: 0.4
retract_speed: 20
unretract_extra_length: 0
unretract_speed: 20

###################################################################################
# G-Code Arcs
###################################################################################

[gcode_arcs]
resolution: 0.1
#   An arc will be split into segments. Each segment's length will
#   equal the resolution in mm set above. Lower values will produce a
#   finer arc, but also more work for your machine. Arcs smaller than
#   the configured value will become straight lines. The default is
#   1mm.

###################################################################################
# Exclude Object (Enabled by default in Kalico)
###################################################################################

[exclude_object]
enable_exclude_object: True
#   Set to `True` to enable `EXCLUDE_OBJECT_*` extended G-Code commands.
#   The default is `True`.

###################################################################################
# Exclude Object (Enabled by default in Kalico)
###################################################################################
# [respond]

###################################################################################
# Input Shaper Hardware
###################################################################################

[include configFiles/ADXL345.cfg]

###################################################################################
#Input Shaper Hardware
###################################################################################
[resonance_tester]
# Assign the RPi sensor to the X-axis
accel_chip: adxl345
probe_points:
    117,112,20
# The following line enables the default sweeping test behavior
# (or explicitly sets the period to 1.2s if you prefer):
#sweeping_period: 0 # Old Version, good when trouble shooting
sweeping_period: 1.2 # New Version, good for final input shaper calibration
#accel_per_hz: 50  # default is 75
max_freq: 150

###################################################################################
# Input Shaper
###################################################################################
[input_shaper]
# shaper_freq_x: 53.2
# shaper_type_x: mzv
# # # To avoid too much smoothing with 'mzv', suggested max_accel <= 17600 mm/sec^2
# shaper_freq_y: 39.0
# shaper_type_y: mzv
# # # To avoid too much smoothing with 'mzv', suggested max_accel <= 16500 mm/sec^2

###################################################################################
# Additional Pins
###################################################################################
[static_digital_output tmc_standby_pins]
pins: !P3.26, !P3.25, !P1.18, !P1.19, !P2.13

# [board_pins]
# aliases:
#     # EXP1 header
#     EXP1_1=PB5, EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8, EXP1_9=<GND>,
#     EXP1_2=PB6, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB7, EXP1_10=<5V>
# # See the sample-lcd.cfg file for definitions of common LCD displays.

# [output_pin beeper]
# pin: EXP1_1

###################################################################################
# Include Files
###################################################################################
# Hardware
[include mainsail.cfg]
[include configFiles/tmcAutoTune.cfg]
[include configFiles/klippain-shaketune.cfg]
# Macros
#[include macros/bentoBox.cfg]

###################################################################################
# Probe
###################################################################################
#######################################
#   +-- BACK ---+
#   |           |
# L |    (+) P  | R <-- probe (20,20)
# E |           | I
# F | (-) N (+) | G <-- nozzle (10,10)
# T |           | H
#   |    (-)    | T
#   |           |
#   O-- FRONT --+
# (0,0)
######################################

[probe]
pin: P1.23
#   Probe detection pin. If the pin is on a different microcontroller
#   than the Z steppers then it enables "multi-mcu homing". This
#   parameter must be provided.

x_offset: -32.0
#   The distance (in mm) between the probe and the nozzle along the
#   x-axis. The default is 0.
y_offset: -6.5
#   The distance (in mm) between the probe and the nozzle along the
#   y-axis. The default is 0.
#z_offset: 0.000 # Initial calibrated height. Textured surface
#   The distance (in mm) between the bed and the nozzle when the probe
#   triggers. This parameter must be provided.
speed: 5.0
#   Speed (in mm/s) of the Z axis when probing. The default is 5mm/s.
samples: 3
#   The number of times to probe each point. The probed z-values will
#   be averaged. The default is to probe 1 time.
sample_retract_dist: 2.0
#   The distance (in mm) to lift the toolhead between each sample (if
#   sampling more than once). The default is 2mm.
lift_speed: 5
#   Speed (in mm/s) of the Z axis when lifting the probe between
#   samples. The default is to use the same value as the 'speed'
#   parameter.
samples_result: median
#   The calculation method when sampling more than once - either
#   "median" or "average". The default is average.
#   Change in 0.000125 steps
#samples_tolerance: 0.00250 ; 30x0.000125
#samples_tolerance:  0.0009375 # 32 microsteps, 3x lowest step distance 0.0003125 (32 microsteps)
samples_tolerance:  0.001875 # 32 microsteps, 3x lowest step distance 0.000625 (16 microsteps)
#   The maximum Z distance (in mm) that a sample may differ from other
#   samples. If this tolerance is exceeded then either an error is
#   reported or the attempt is restarted (see
#   samples_tolerance_retries). The default is 0.100mm.
samples_tolerance_retries: 20
#   The number of times to retry if a sample is found that exceeds
#   samples_tolerance. On a retry, all current samples are discarded
#   and the probe attempt is restarted. If a valid set of samples are
#   not obtained in the given number of retries then an error is
#   reported. The default is zero which causes an error to be reported
#   on the first sample that exceeds samples_tolerance.
#activate_gcode:
#   A list of G-Code commands to execute prior to each probe attempt.
#   See docs/Command_Templates.md for G-Code format. This may be
#   useful if the probe needs to be activated in some way. Do not
#   issue any commands here that move the toolhead (eg, G1). The
#   default is to not run any special G-Code commands on activation.
#deactivate_gcode:
#   A list of G-Code commands to execute after each probe attempt
#   completes. See docs/Command_Templates.md for G-Code format. Do not
#   issue any commands here that move the toolhead. The default is to
#   not run any special G-Code commands on deactivation.
#z_offset: 0.930

###################################################################################
# Axis Twist
###################################################################################

[axis_twist_compensation]
speed: 50
horizontal_move_z: 5
calibrate_start_x: 20
calibrate_end_x: 200
calibrate_y: 113        ; Middle of your usable Y (226 / 2)

###################################################################################
# Host Sensors
###################################################################################

[temperature_sensor Mainboard]
sensor_type: NTC 100K MGB18-104F39050L32
sensor_pin: P1.30
min_temp: 10
max_temp: 100

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

###################################################################################
# Fans
###################################################################################
#pin:
#max_power: 1.0
#shutdown_speed: 0
#   is 0.
#cycle_time: 0.010
#hardware_pwm: False
#kick_start_time: 0.100
#min_power: 0.0
#tachometer_pin:
#tachometer_ppr: 2
#tachometer_poll_interval: 0.0015
#enable_pin:
#off_below:
#initial_speed:
[fan]
pin: P2.1

[heater_fan heatbreak_cooling_fan]
pin: P2.2

[controller_fan stepper_driver_fan]
pin: P2.4  # <-- IMPORTANT: Change this to your fan's signal pin
stepper: stepper_x, stepper_y, stepper_z, extruder
# Add any other steppers you want to monitor (e.g., stepper_z1, extruder1)
idle_timeout: 30
# The fan will stay on for 30 seconds after the steppers disable.
# You can change this time or remove the line to use the 30s default.
max_power: 0.45


###################################################################################
# Leds
###################################################################################
# Hardware
[include configFiles/leds.cfg]
# Macros
#[include macros/stealthburner_led_effects_barf.cfg]

###################################################################################
# TMC Driver Configuration
###################################################################################
[tmc2209 stepper_x]
uart_pin: P1.1
interpolate: False # Allows TMC2209 to microstep up to 256 steps. Can introduce inarruracies so recommended to be off
#run_current: 1.00
run_current: 0.80 # 50% of the TMC2209 Constant recommended current Max <1.3v
sense_resistor: 0.110
#stealthchop_threshold: 999999
stealthchop_threshold: 0

[tmc2209 stepper_y]
uart_pin: P1.10
interpolate: False # Allows TMC2209 to microstep up to 256 steps. Can introduce inarruracies so recommended to be off
#run_current: 1.00
run_current: 0.80 # 50% of the TMC2209 Constant recommended current Max <1.3v
sense_resistor: 0.110
#stealthchop_threshold: 999999
stealthchop_threshold: 0

[tmc2209 stepper_z]
uart_pin: P1.17
interpolate: False # Allows TMC2209 to microstep up to 256 steps. Can introduce inarruracies so recommended to be off
# run_current: 0.580 # Original BTT config value
# run_current: 0.50 # Set to 45% of the motors rated constant max rating
run_current: 0.65 # 50% of the TMC2209 Constant recommended current Max <1.3v
sense_resistor: 0.110
#stealthchop_threshold: 999999
stealthchop_threshold: 0

[tmc2209 stepper_z1]
uart_pin: P0.22
interpolate: False # Allows TMC2209 to microstep up to 256 steps. Can introduce inarruracies so recommended to be off
#diag_pin: P1.25
#run_current: 0.850
# run_current: 0.580 # Original BTT config value
# run_current: 0.50 # Set to 45% of the motors rated constant max rating
run_current: 0.65 # 50% of the TMC2209 Constant recommended current Max <1.3v
sense_resistor: 0.110
#stealthchop_threshold: 999999
stealthchop_threshold: 0

[tmc2209 extruder]
uart_pin: P0.5
interpolate: False # Allows TMC2209 to microstep up to 256 steps. Can introduce inarruracies so recommended to be off
#run_current: 0.79 # ZeroG 80% Run Current suggestion
#run_current: 0.85 # LDO Instructions Run Current suggestion
run_current: 0.60
#hold_current: 0.100
sense_resistor: 0.110
stealthchop_threshold: 0
driver_TBL: 0
driver_HEND: 6
driver_HSTRT:7
driver_TOFF: 4

###################################################################################
# Display
###################################################################################

######################################################################
# 128x64 Full Graphic Creality CR10 / ENDER 3 stockdisplay
######################################################################

# This section is used for a Creality "12864" display with a single
# ribbon cable between the display's EXP3 plug and the
# micro-controller board's EXP1 connector.

[display]
lcd_type: st7920
menu_timeout: 300 # 5 Minutes
cs_pin: EXP1_7
sclk_pin: EXP1_6
sid_pin: EXP1_8
encoder_pins: ^EXP1_5, ^EXP1_3
click_pin: ^!EXP1_2

[output_pin beeper]
pin: EXP1_1

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=P2.8,  EXP1_3=P0.19, EXP1_5=P0.20, EXP1_7=P0.17, EXP1_9=<GND>,
    EXP1_2=P0.16, EXP1_4=<RST>, EXP1_6=P0.15, EXP1_8=P0.18, EXP1_10=<5V>

# See the sample-lcd.cfg file for definitions of common LCD displays.

###################################################################################
# Custom LCD Menus
###################################################################################

#[include configFiles/lcd_menu_settings.cfg]

###################################################################################
# Filament Runot Sensor
###################################################################################
[include configFiles/bttSmartFilamentSensorV2.cfg]

###################################################################################
# Notes:
###################################################################################

# Backup 28/02/2026
#Adjust z in 0.005 increments
# Textured Plate Calibrated Z Height
# z_offset: 0.490 # starting point 12-02-2026
# 
#
# Smooth Plate Calibrated Z Height
# z_offset: 0.180 # starting point 12-02-2026

# The smallest step distance possible with that setup is 0.0003125 mm (or 0.3125 microns). (32 microsteps)
# The smallest step distance possible with that setup is 0.000625 mm (or 0.3125 microns). (16 microsteps)

# [extruder]
# pid_version = 1
# pid_target = 240.00
# pid_tolerance = 0.0200
# control = pid
# pid_kp = 19.226
# pid_ki = 2.481
# pid_kd = 37.251
#
# [probe]
# z_offset = 1.430
#
# [skew_correction Calilantern]
# xy_skew = -0.0018370691874910903
# xz_skew = 0.001499777242476043
# yz_skew = -0.00016617075249606314

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# pid_version = 1
#*# pid_target = 230.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 18.286
#*# pid_ki = 2.257
#*# pid_kd = 37.029
#*#
#*# [heater_bed]
#*# pid_version = 1
#*# pid_target = 90.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 62.040
#*# pid_ki = 1.213
#*# pid_kd = 793.334
#*#
#*# [probe]
#*# z_offset = 1.580
